<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="HKMC Barcode">
<meta name="theme-color" content="#7c3aed">
<title>HKMC 2D Barcode Reader</title>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  var(--p):        #7c3aed;
  --p-mid:    #8b5cf6;
  --p-light:  #a78bfa;
  --p-pale:   #c4b5fd;
  --p-ghost:  #ede9fe;
  --p-bg:     #f5f3ff;
  --green:    #10b981;
  --green-bg: #d1fae5;
  --red:      #ef4444;
  --red-bg:   #fee2e2;
  --amber:    #f59e0b;
  --teal:     #06b6d4;
  --ink:      #1e1b4b;
  --ink-2:    #4c4980;
  --ink-3:    #8b89c0;
  --ink-4:    #c4c3e0;
  --border:   #e5e3f5;
  --surface:  #ffffff;
  --bg:       #f5f3ff;
  --safe-b:   env(safe-area-inset-bottom, 0px);
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
  font-family: 'Plus Jakarta Sans', -apple-system, 'Apple SD Gothic Neo', sans-serif;
  background: var(--bg);
  color: var(--ink);
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-text-size-adjust: 100%;
}

.page { display:none; min-height:100dvh; padding-bottom:calc(82px + var(--safe-b)); }
.page.active { display:block; animation: pgIn .3s cubic-bezier(.4,0,.2,1); }
@keyframes pgIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }

.hdr {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 50px 16px 13px;
  display: flex; align-items: center; justify-content: space-between;
  position: sticky; top:0; z-index:30;
}
/* Î°úÍ≥†ÏôÄ Ï†úÎ™© Ï†ïÎ†¨ÏùÑ ÏúÑÌïú Ïä§ÌÉÄÏùº ÏàòÏ†ï */
.hdr-left {
  display: flex;
  align-items: center;
  gap: 12px;
}
.hdr-logo {
  width: 44px;
  height: auto;
}
.hdr-eyebrow { /* Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©ÎêòÏßÄ ÏïäÏùå, ÏÇ≠Ï†ú Í∞ÄÎä• */
  font-size: 10px; font-weight: 700; color: var(--ink-3);
  text-transform: uppercase; letter-spacing: .8px; margin-bottom: 2px;
}
.hdr-title { font-size: 18px; font-weight: 900; color: var(--ink); letter-spacing: -.3px; }
.hdr-badge {
  padding: 5px 14px; border-radius: 999px;
  font-size: 11px; font-weight: 800; letter-spacing: .4px;
  display: none;
  animation: badgePop .3s cubic-bezier(.34,1.5,.64,1);
}
@keyframes badgePop { from{transform:scale(.4);opacity:0} to{transform:scale(1);opacity:1} }
.hdr-badge.ok { background:var(--green-bg); color:var(--green); }
.hdr-badge.ng { background:var(--red-bg);   color:var(--red); }

.wrap { padding: 14px 14px 0; }

.hero-card {
  background: linear-gradient(135deg, var(--p) 0%, #4338ca 100%);
  border-radius: 20px;
  padding: 22px 18px 20px;
  margin-bottom: 8px;
  position: relative; overflow: hidden;
  box-shadow: 0 6px 28px rgba(124,58,237,.3);
}
.hero-card::before {
  content:''; position:absolute;
  width:160px; height:160px; border-radius:50%;
  background: rgba(255,255,255,.07);
  top:-60px; right:-50px;
  animation: blobDrift 7s ease-in-out infinite;
}
.hero-card::after {
  content:''; position:absolute;
  width:90px; height:90px; border-radius:50%;
  background: rgba(255,255,255,.05);
  bottom:-30px; left:24px;
  animation: blobDrift 9s ease-in-out infinite reverse;
}
@keyframes blobDrift { 0%,100%{transform:translateY(0) scale(1)} 50%{transform:translateY(-8px) scale(1.05)} }

.hero-label  { font-size:10px; font-weight:700; color:rgba(255,255,255,.55); text-transform:uppercase; letter-spacing:1px; margin-bottom:5px; position:relative; z-index:1; }
.hero-value  { font-size:26px; font-weight:900; color:#fff; line-height:1; margin-bottom:3px; position:relative; z-index:1; letter-spacing:-.5px; }
.hero-sub    { font-size:12px; color:rgba(255,255,255,.5); font-weight:500; position:relative; z-index:1; }

.hero-deco {
  position:absolute; right:16px; top:50%; transform:translateY(-50%);
  z-index:1; opacity:.22;
}
.hero-deco svg { width:65px; height:65px; }

.hero-btn {
  margin-top:18px; width:100%; padding:12px 16px;
  background:rgba(255,255,255,.14);
  border:1.5px solid rgba(255,255,255,.25);
  border-radius:13px; color:#fff;
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:14px; font-weight:800; cursor:pointer;
  display:flex; align-items:center; justify-content:center; gap:9px;
  position:relative; z-index:1;
  backdrop-filter:blur(4px);
  transition:background .15s;
}
.hero-btn:active { background:rgba(255,255,255,.22); transform:scale(.98); }
.hero-btn svg { width:18px; height:18px; stroke:#fff; fill:none; stroke-width:2; }

.sec-label {
  font-size: 11px; font-weight: 800;
  color: var(--ink-3);
  text-transform: uppercase; letter-spacing: .8px;
  margin: 16px 2px 8px; display:flex; align-items:center; gap:6px;
}
.sec-label svg {
  width: 14px; height: 14px; stroke: var(--p); stroke-width: 2; fill: none;
}
.sec-label::after {
  content:''; flex:1; height:1px; background:var(--border);
}

.panel {
  background:var(--surface); border:1px solid var(--border);
  border-radius:16px; margin-bottom:12px; overflow:hidden;
  box-shadow:0 1px 4px rgba(124,58,237,.05);
  animation: cardIn .35s cubic-bezier(.34,1.1,.64,1) .25s both;
}
@keyframes cardIn { from{opacity:0;transform:translateY(12px) scale(.97)} to{opacity:1;transform:none} }

.panel-head {
  padding:12px 14px;
  display:flex; align-items:center; justify-content:space-between;
  border-bottom:1px solid var(--border);
}
.panel-head-l { display:flex; align-items:center; gap:9px; }
.panel-icon {
  width:30px; height:30px; border-radius:9px;
  background:var(--p-ghost);
  display:flex; align-items:center; justify-content:center; flex-shrink:0;
}
.panel-icon svg { width:15px; height:15px; stroke:var(--p); fill:none; stroke-width:2; }
.panel-title    { font-size:13px; font-weight:800; color:var(--ink); }
.panel-sub      { font-size:10px; color:var(--ink-3); margin-top:1px; }
.panel-chip {
  padding:3px 10px; border-radius:999px;
  font-size:10px; font-weight:800; letter-spacing:.3px;
}
.panel-chip.ok { background:var(--green-bg); color:var(--green); }
.panel-chip.ng { background:var(--red-bg);   color:var(--red); }

.barcode-raw {
  padding:13px 14px;
  font-family:'JetBrains Mono',monospace;
  font-size:11px; line-height:2; word-break:break-all; white-space:pre-line;
  color:var(--ink-2); background:var(--bg);
}
.highlight-yellow { background:#fef9c3; border-radius:3px; color:var(--ink); font-weight:700; padding:0 2px; }
.gs  { color:#ef4444; font-weight:700; font-size:10px; }
.rs  { color:#10b981; font-weight:700; font-size:10px; }
.eot { color:var(--p);  font-weight:700; font-size:10px; }

.result-table { width:100%; border-collapse:collapse; font-size:11.5px; }
.result-table th,.result-table td { border:1px solid var(--border); padding:7px 8px; vertical-align:middle; }
.result-table thead th {
  background:var(--p-ghost); color:var(--p);
  font-weight:800; text-align:center;
  font-size:10px; letter-spacing:.4px; text-transform:uppercase;
}
.td-head { background:var(--bg); text-align:center; font-weight:700; color:var(--ink-2); font-size:10.5px; white-space:pre-line; line-height:1.4; }
.td-center { text-align:center; }
.td-data { font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--ink); word-break:break-all; }
.badge-ok { display:inline-flex; align-items:center; background:var(--green-bg); color:var(--green); padding:2px 7px; border-radius:999px; font-size:9px; font-weight:900; animation: badgePop .2s cubic-bezier(.34,1.6,.64,1); }
.badge-ng { display:inline-flex; align-items:center; background:var(--red-bg);   color:var(--red);   padding:2px 7px; border-radius:999px; font-size:9px; font-weight:900; animation: badgePop .2s cubic-bezier(.34,1.6,.64,1); }

.tab-scroll { overflow-x:auto; padding:10px 14px 0; -webkit-overflow-scrolling:touch; }
.tab-scroll::-webkit-scrollbar{display:none}
.tab-row { display:flex; gap:6px; }
.tab-btn {
  flex-shrink:0; padding:5px 14px;
  border:1.5px solid var(--border); background:var(--surface);
  border-radius:999px; font-family:'Plus Jakarta Sans',sans-serif;
  font-size:11px; font-weight:800; color:var(--ink-3); cursor:pointer; transition:all .15s;
}
.tab-btn.active { background:var(--p); color:#fff; border-color:var(--p); box-shadow:0 2px 8px rgba(124,58,237,.3); }

.bottom-nav {
  position:fixed; bottom:0; left:0; right:0; z-index:40;
  background:rgba(255,255,255,.96);
  backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  border-top:1px solid var(--border);
  padding:10px 14px; padding-bottom:calc(10px + var(--safe-b));
  display:flex; gap:8px;
}
.nav-btn {
  flex:1; padding:10px 4px;
  border:none; border-radius:13px;
  background:var(--bg); color:var(--ink-3);
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:10px; font-weight:800; cursor:pointer;
  display:flex; flex-direction:column; align-items:center; gap:4px;
  transition:all .15s; position:relative;
}
.nav-btn svg { width:20px; height:20px; stroke:currentColor; fill:none; stroke-width:2; }
.nav-btn.on { background:var(--p-ghost); color:var(--p); }
.nav-btn.primary {
  background: linear-gradient(135deg, var(--p), #4338ca);
  color:#fff;
  box-shadow: 0 4px 14px rgba(124,58,237,.35);
}
.nav-btn.primary:active { transform:scale(.96); }
.nav-btn:not(.primary):active { transform:scale(.97); }
.nav-dot {
  position:absolute; top:5px; right:7px;
  background:var(--red); color:#fff; font-size:9px; font-weight:900;
  min-width:15px; height:15px; border-radius:999px;
  display:flex; align-items:center; justify-content:center; padding:0 3px;
}

.hist-empty { text-align:center; padding:50px 20px; }
.hist-empty-icon { width:64px; height:64px; border-radius:18px; background:var(--p-ghost); margin:0 auto 14px; display:flex; align-items:center; justify-content:center; }
.hist-empty-icon svg { width:28px; height:28px; stroke:var(--p); fill:none; stroke-width:1.5; }
.hist-empty-title { font-size:15px; font-weight:800; color:var(--ink); margin-bottom:4px; }
.hist-empty-sub   { font-size:12px; color:var(--ink-3); font-weight:600; }

.hist-item {
  background:var(--surface); border:1px solid var(--border);
  border-radius:15px; padding:12px 13px; margin-bottom:8px;
  display:flex; align-items:center; gap:11px;
  box-shadow:0 1px 4px rgba(124,58,237,.04);
  animation:cardIn .3s cubic-bezier(.34,1.1,.64,1) both;
}
.hist-badge { flex-shrink:0; padding:4px 10px; border-radius:999px; font-size:10px; font-weight:900; }
.hist-badge.ok { background:var(--green-bg); color:var(--green); }
.hist-badge.ng { background:var(--red-bg);   color:var(--red); }
.hist-meta { flex:1; min-width:0; }
.hist-date { font-size:10px; color:var(--ink-3); font-weight:600; margin-bottom:3px; }
.hist-code { font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--ink-2); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.hist-view {
  flex-shrink:0; padding:7px 12px;
  background:var(--p-ghost); color:var(--p);
  border:1.5px solid var(--p-pale); border-radius:9px;
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:11px; font-weight:800; cursor:pointer;
}

.lang-opt {
  padding:16px 14px; border-bottom:1px solid var(--border);
  cursor:pointer; font-size:14px; font-weight:700; color:var(--ink);
  display:flex; align-items:center; justify-content:space-between;
}
.lang-opt:last-child{border-bottom:none}
.lang-opt:active{background:var(--bg)}
.lang-check{color:var(--p);font-weight:900;display:none}

/* ‚îÄ‚îÄ‚îÄ Ïä§Ï∫î Ïò§Î≤ÑÎ†àÏù¥ ‚îÄ‚îÄ‚îÄ */
.scan-overlay {
  position:fixed; inset:0; z-index:100; background:#000;
  display:none; flex-direction:column;
}
.scan-overlay.open{display:flex}
#qr-reader{position:absolute;inset:0;width:100%;height:100%}
#qr-reader video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

.scan-ui{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none}

.dim-t{position:absolute;top:0;left:0;right:0;height:calc(50% - 125px);background:rgba(0,0,0,.6)}
.dim-b{position:absolute;bottom:0;left:0;right:0;height:calc(50% - 125px);background:rgba(0,0,0,.6)}
.dim-l{position:absolute;top:calc(50% - 125px);bottom:calc(50% - 125px);left:0;width:calc(50% - 125px);background:rgba(0,0,0,.6)}
.dim-r{position:absolute;top:calc(50% - 125px);bottom:calc(50% - 125px);right:0;width:calc(50% - 125px);background:rgba(0,0,0,.6)}

.scan-box{
  position:absolute;
  top:50%; left:50%; transform:translate(-50%, -50%);
  width:250px; height:250px;
}
.sc{position:absolute;width:22px;height:22px}
.sc::before,.sc::after{content:'';position:absolute;border-radius:2px}
.sc-tl::before{top:0;left:0;width:3px;height:22px;background:var(--p-pale)}
.sc-tl::after {top:0;left:0;width:22px;height:3px;background:var(--p-pale)}
.sc-tr::before{top:0;right:0;width:3px;height:22px;background:var(--p-pale)}
.sc-tr::after {top:0;right:0;width:22px;height:3px;background:var(--p-pale)}
.sc-bl::before{bottom:0;left:0;width:3px;height:22px;background:var(--p-pale)}
.sc-bl::after {bottom:0;left:0;width:22px;height:3px;background:var(--p-pale)}
.sc-br::before{bottom:0;right:0;width:3px;height:22px;background:var(--p-pale)}
.sc-br::after {bottom:0;right:0;width:22px;height:3px;background:var(--p-pale)}
.sc-tl{top:0;left:0}.sc-tr{top:0;right:0}.sc-bl{bottom:0;left:0}.sc-br{bottom:0;right:0}

.scan-beam {
  position:absolute;left:4px;right:4px;height:2px;
  background:linear-gradient(90deg,transparent,var(--p-light),#fff 50%,var(--p-light),transparent);
  box-shadow:0 0 12px 3px rgba(167,139,250,.7);
  animation:beam 2s ease-in-out infinite;
}
@keyframes beam{0%,100%{top:2%;opacity:0}5%{opacity:1}95%{opacity:1}100%{top:98%;opacity:0}}
.scan-pulse{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:48px;height:48px;border-radius:50%;border:2px solid rgba(167,139,250,.6);animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.6}50%{transform:translate(-50%,-50%) scale(1.6);opacity:0}}

.scan-hint{position:absolute;bottom:calc(50% - 160px);left:0;right:0;text-align:center;color:rgba(255,255,255,.6);font-size:12px;font-weight:700}
.scan-footer{position:absolute;bottom:0;left:0;right:0;background:rgba(15,8,40,.88);backdrop-filter:blur(12px);padding:18px 16px;padding-bottom:calc(18px + var(--safe-b));pointer-events:all}
.scan-stop{width:100%;padding:14px;background:rgba(167,139,250,.15);color:#fff;border:1.5px solid rgba(167,139,250,.3);border-radius:14px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
.scan-stop svg{width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2}

.flash{position:fixed;inset:0;z-index:200;background:rgba(245,243,255,.8);pointer-events:none;animation:fadeOut .4s ease-out forwards}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
</style>
</head>
<body>

<div id="page-main" class="page active">

  <div class="hdr">
    <div class="hdr-left">
      <svg class="hdr-logo" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="120" height="120" rx="24" fill="var(--p)"/>
        <path d="M24 32V68M24 50H40M40 32V68 M52 32V68M52 50L68 32M52 50L68 68 M80 32V68L96 32V68" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
        <rect x="24" y="82" width="72" height="6" fill="white" opacity="0.4"/>
        <rect x="24" y="92" width="48" height="6" fill="white" opacity="0.7"/>
        <rect x="76" y="92" width="20" height="6" fill="white" opacity="0.4"/>
      </svg>
      <div class="hdr-title">HKMC 2D Barcode Reader</div>
    </div>
    <div id="hdrBadge" class="hdr-badge"></div>
  </div>

  <div class="wrap">

    <div class="hero-card" id="heroCard">
      <div class="hero-label" id="heroLabel">Î∞îÏΩîÎìú Î∂ÑÏÑùÍ∏∞</div>
      <div class="hero-value" id="heroValue">Ïä§Ï∫î ÎåÄÍ∏∞ Ï§ë</div>
      <div class="hero-sub"   id="heroSub">ÏïÑÎûò Î≤ÑÌäºÏùÑ ÎàåÎü¨ Ïä§Ï∫îÌïòÏÑ∏Ïöî</div>
      <div class="hero-deco">
        <svg viewBox="0 0 65 65" fill="none">
          <rect x="4"  y="12" width="5"   height="41" rx="2" fill="white"><animate attributeName="height" values="41;30;41" dur="2.2s" repeatCount="indefinite" begin="0s"/><animate attributeName="y" values="12;18;12" dur="2.2s" repeatCount="indefinite" begin="0s"/></rect>
          <rect x="13" y="9"  width="3"   height="47" rx="1.5" fill="white" opacity=".7"><animate attributeName="height" values="47;34;47" dur="1.9s" repeatCount="indefinite" begin=".15s"/><animate attributeName="y" values="9;16;9" dur="1.9s" repeatCount="indefinite" begin=".15s"/></rect>
          <rect x="20" y="14" width="6"   height="37" rx="2" fill="white"><animate attributeName="height" values="37;50;37" dur="2.1s" repeatCount="indefinite" begin=".3s"/><animate attributeName="y" values="14;8;14" dur="2.1s" repeatCount="indefinite" begin=".3s"/></rect>
          <rect x="30" y="10" width="2.5" height="45" rx="1.2" fill="white" opacity=".6"><animate attributeName="height" values="45;30;45" dur="2.5s" repeatCount="indefinite" begin=".1s"/><animate attributeName="y" values="10;18;10" dur="2.5s" repeatCount="indefinite" begin=".1s"/></rect>
          <rect x="36" y="13" width="5"   height="39" rx="2" fill="white"><animate attributeName="height" values="39;52;39" dur="1.8s" repeatCount="indefinite" begin=".2s"/><animate attributeName="y" values="13;7;13" dur="1.8s" repeatCount="indefinite" begin=".2s"/></rect>
          <rect x="45" y="9"  width="3"   height="47" rx="1.5" fill="white" opacity=".75"><animate attributeName="height" values="47;35;47" dur="2.3s" repeatCount="indefinite" begin=".35s"/><animate attributeName="y" values="9;15;9" dur="2.3s" repeatCount="indefinite" begin=".35s"/></rect>
          <rect x="52" y="16" width="6"   height="33" rx="2" fill="white"><animate attributeName="height" values="33;46;33" dur="2s" repeatCount="indefinite" begin=".05s"/><animate attributeName="y" values="16;10;16" dur="2s" repeatCount="indefinite" begin=".05s"/></rect>
          <rect x="2" y="0" width="61" height="2.5" rx="1" fill="url(#hg)" opacity=".9">
            <animateTransform attributeName="transform" type="translate" values="0,10;0,52;0,10" dur="2s" repeatCount="indefinite"/>
          </rect>
          <defs>
            <linearGradient id="hg" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%"   stop-color="transparent"/>
              <stop offset="35%"  stop-color="#c4b5fd"/>
              <stop offset="50%"  stop-color="#ffffff"/>
              <stop offset="65%"  stop-color="#c4b5fd"/>
              <stop offset="100%" stop-color="transparent"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <button class="hero-btn" onclick="startScan()">
        <svg viewBox="0 0 24 24"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        <span id="scanBtnLabel">Î∞îÏΩîÎìú Ïä§Ï∫î ÏãúÏûë</span>
      </button>
    </div>

    <div id="barcodePanel" style="display:none">
      <div class="sec-label">
        <svg viewBox="0 0 24 24"><path d="M3 5v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2zm2 0h14v14H5V5zm2 2h2v10H7V7zm4 0h2v10h-2V7zm4 0h2v10h-2V7z"/></svg>
        Î∞îÏΩîÎìú Îç∞Ïù¥ÌÑ∞
      </div>
      <div class="panel">
        <div class="panel-head">
          <div class="panel-head-l">
            <div class="panel-icon"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="5" height="5" rx=".5"/><rect x="16" y="3" width="5" height="5" rx=".5"/><rect x="3" y="16" width="5" height="5" rx=".5"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="12" y1="11" x2="16" y2="11"/></svg></div>
            <div><div class="panel-title" id="secBarcode">Î∞îÏΩîÎìú ÎÇ¥Ïö©</div><div class="panel-sub">Raw data</div></div>
          </div>
          <div id="rawChip" class="panel-chip"></div>
        </div>
        <div id="tabSection" style="display:none">
          <div class="tab-scroll"><div class="tab-row" id="tabBar"></div></div>
        </div>
        <div class="barcode-raw" id="fullViewData"></div>
      </div>
    </div>

    <div id="resultPanel" style="display:none">
      <div class="sec-label">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
        Î∂ÑÏÑù ÏÉÅÏÑ∏
      </div>
      <div class="panel">
        <div class="panel-head">
          <div class="panel-head-l">
            <div class="panel-icon" style="background:#ecfdf5"><svg viewBox="0 0 24 24" style="stroke:#10b981"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/><path d="M9 14l2 2 4-4"/></svg></div>
            <div><div class="panel-title" id="secResult">Î∂ÑÏÑù Í≤∞Í≥º</div><div class="panel-sub" id="secStd">H/KMC Î∂ÄÌíà 2D Î∞îÏΩîÎìú ÌëúÏ§Ä</div></div>
          </div>
        </div>
        <div style="overflow-x:auto">
          <table class="result-table" id="resultTable"></table>
        </div>
      </div>
    </div>

    <div id="rescanWrap" style="display:none;padding-bottom:4px">
      <button onclick="startScan()" style="width:100%;padding:14px;background:var(--p);color:#fff;border:none;border-radius:14px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:9px;box-shadow:0 4px 16px rgba(124,58,237,.3)">
        <svg style="width:18px;height:18px;stroke:#fff;fill:none;stroke-width:2" viewBox="0 0 24 24"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        Îã§Ïãú Ïä§Ï∫î
      </button>
    </div>

  </div><div class="bottom-nav">
    <button class="nav-btn" onclick="showPage('language')" id="navLang">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 010 20M12 2a15.3 15.3 0 000 20M2 12h20"/></svg>
      Ïñ∏Ïñ¥
    </button>
    <button class="nav-btn" onclick="showPage('history')" id="navHist">
      <svg viewBox="0 0 24 24"><path d="M12 8v4l3 3M3.05 11a9 9 0 100 2"/><path d="M3 4v4h4"/></svg>
      Ïù¥Î†•
      <span class="nav-dot" id="histDot" style="display:none"></span>
    </button>
    <button class="nav-btn primary" onclick="startScan()">
      <svg viewBox="0 0 24 24"><rect x="3" y="3" width="6" height="6" rx="1"/><rect x="15" y="3" width="6" height="6" rx="1"/><rect x="3" y="15" width="6" height="6" rx="1"/><path d="M15 15h2v2h2v2h2M17 19h2M15 17v2"/></svg>
      Ïä§Ï∫î
    </button>
  </div>
</div>

<div id="page-history" class="page">
  <div class="hdr">
    <div class="hdr-left">
      <div class="hdr-title" id="histPageTitle">Î∞îÏΩîÎìú Ïù¥Î†•</div>
    </div>
  </div>
  <div class="wrap" id="historyContent"></div>
  <div class="bottom-nav">
    <button class="nav-btn" onclick="clearHistory()" id="histClear" style="color:var(--red);background:#fff0f0;border:1px solid #fecaca;">
      <svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6M10 11v6M14 11v6M9 6V4h6v2"/></svg>
      Ï†ÑÏ≤¥ÏÇ≠Ï†ú
    </button>
    <button class="nav-btn primary" onclick="showPage('main')" id="histClose">
      <svg viewBox="0 0 24 24"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      Îã´Í∏∞
    </button>
  </div>
</div>

<div id="page-language" class="page">
  <div class="hdr">
    <div class="hdr-left">
      <div class="hdr-title" id="langPageTitle">Ïñ∏Ïñ¥ ÏÑ†ÌÉù</div>
    </div>
  </div>
  <div class="wrap">
    <div class="panel">
      <div style="background:#fff">
        <div class="lang-opt" onclick="setLang('ko')">üá∞üá∑ ÌïúÍµ≠Ïñ¥<span id="chkKo" class="lang-check">‚úì</span></div>
        <div class="lang-opt" onclick="setLang('en')">üá∫üá∏ English<span id="chkEn" class="lang-check">‚úì</span></div>
      </div>
    </div>
  </div>
  <div class="bottom-nav">
    <button class="nav-btn primary" onclick="showPage('main')" id="langClose">
      <svg viewBox="0 0 24 24"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      Îã´Í∏∞
    </button>
  </div>
</div>

<div id="scanOverlay" class="scan-overlay">
  <div id="qr-reader"></div>
  <div class="scan-ui">
    <div class="dim-t"></div><div class="dim-b"></div>
    <div class="dim-l"></div><div class="dim-r"></div>
    <div class="scan-box">
      <div class="sc sc-tl"></div><div class="sc sc-tr"></div>
      <div class="sc sc-bl"></div><div class="sc sc-br"></div>
      <div class="scan-beam"></div>
      <div class="scan-pulse"></div>
    </div>
    <div class="scan-hint" id="scanHint">Î∞îÏΩîÎìúÎ•º ÌîÑÎ†àÏûÑ ÏïàÏóê ÎßûÏ∂∞Ï£ºÏÑ∏Ïöî</div>
  </div>
  <div class="scan-footer">
    <button class="scan-stop" onclick="closeScanner()" id="stopScanBtn">
      <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
      Ïä§Ï∫î Ï§ëÏßÄ
    </button>
  </div>
</div>

<div id="flashEffect" class="flash" style="display:none"></div>

<script>
/* ‚îÄ‚îÄ DataAnalyzer ‚îÄ‚îÄ */
function DataAnalyzer(){var D=[],DL=[],RD=[],cnt=0,sel=0;this.setBarcodeData=function(s){D=[];DL=[];RD=[];cnt=0;sel=0;af(s);sd();};this.setSelectIndex=function(i){sel=i;};this.getSelectedIndex=function(){return sel;};this.getFullViewData=function(){var r='';DL.forEach(function(row,i){if(i===sel)r+='<span class="highlight-yellow">';row.forEach(function(v){r+=cc(v);});if(i===sel)r+='</span>';});return r;};this.getCount=function(){return cnt;};this.getCheckResult=function(){return dc();};this.getResultData=function(){return RD;};function af(s){D=[];for(var i=0;i<s.length;i++)if(s.charCodeAt(i)!==32)D.push(s.charCodeAt(i));}function sd(){var r=[];D.forEach(function(v){r.push(v);if(v===35){DL.push(r);r=[];cnt++;}});if(r.length>0){DL.push(r);cnt++;}}function lp(n,w){n=n+'';return n.length>=w?n:new Array(w-n.length+1).join('0')+n;}function cc(s){if(s===29)return'<span class="gs"><sup>G</sup><sub>S</sub></span>';if(s===30)return'<span class="rs"><sup>R</sup><sub>S</sub></span>';if(s===4)return'<span class="eot"><sup>E</sup>O<sub>T</sub></span>';if(s===35)return'#<br>';if((s>=0&&s<=32)||s===127)return'&lt;0x'+lp(s.toString(16).toUpperCase(),2)+'&gt;';return String.fromCharCode(s);}function ad(a){var r='';if(typeof a==='number')return cc(a);if(a)a.forEach(function(v){r+=cc(v);});return r;}function hc(a,c){return a.some(function(v){return v===c;});}function vd(a){var s='';a.forEach(function(v){s+=String.fromCharCode(v);});if(!/[0-9]{2}[0-1]{1}[0-9]{1}[0-9]{2}/.test(s))return false;var ld=[31,28,31,30,31,30,31,31,30,31,30,31],y=Number('20'+s.substr(0,2)),m=Number(s.substr(2,2)),d=Number(s.substr(4,2));if(m>12||m===0||d===0)return false;if(y%4===0&&(y%100!==0||y%400===0)&&m===2)return d<=29;return d<=ld[m-1];}function ba(a){if(!a||(Array.isArray(a)&&a.length===0))return false;var c=function(v){return v<47||(v>57&&v<65)||(v>90&&v<97)||v>122;};if(typeof a==='number')return c(a);for(var i=0;i<a.length;i++)if(c(a[i]))return true;return false;}function sg(a){var r=[],row=[];a.forEach(function(v){if(v===29){r.push(row.slice(0));row=[];}else row.push(v);});return r;}function fb(a){var c=-1;a.some(function(v,i){if(v===29){c=i;return true;}return false;});return a.slice(0,c);}function lb(a){var c=-1;for(var x=a.length;x>0;x--)if(a[x]===29){c=x+1;break;}return a.slice(c);}function dd(t,ok,d,ri){if(sel===ri){if(t!=='00'&&t!=='50')if(ba(d))ok=false;RD.push([t,ok?'OK':'NG',d!=null?ad(d):null]);}}function dc(){var result=true;RD=[];DL.forEach(function(rd,ri){var e00=0,e10=0,e11=0,e12=0,e13=0,e20=0,e21=0,e22=0,e23=0,e30=0,e31=0,e40=0,e50=0;if(rd.length>=7){if(rd[0]===91&&rd[1]===41&&rd[2]===62&&rd[3]===30&&rd[4]===48&&rd[5]===54&&rd[6]===29){e00=1;dd('00',true,rd.slice(0,6),ri);}else if(rd[0]===91){var c=-1;rd.some(function(v,i){if(v===29){c=i;return true;}return false;});if(c>0){e00=1;dd('00',false,rd.slice(0,c),ri);}}}else result=false;if(rd[rd.length-1]===35||rd[rd.length-1]===4){e50=1;if(rd[rd.length-4]===29&&rd[rd.length-3]===30&&rd[rd.length-2]===4&&rd[rd.length-1]===35)dd('50',true,rd.slice(rd.length-3,rd.length-1),ri);else if(rd[rd.length-3]===29&&rd[rd.length-2]===30&&rd[rd.length-1]===4)dd('50',true,rd.slice(rd.length-2),ri);else{result=false;var c2=-1;for(var x=rd.length;x>0;x--)if(rd[x]===29){c2=x+1;break;}dd('50',false,rd.slice(c2),ri);}}sg(rd).forEach(function(pd){if(pd[0]===86){e10=1;dd('10',pd.length===5,pd.slice(1),ri);if(pd.length!==5)result=false;}else if(pd[0]===80){e11=1;if(pd.length>10&&pd.length<17){if(!hc(pd,45))dd('11',true,pd.slice(1),ri);else dd('11',false,pd.slice(1),ri);}else{result=false;dd('11',false,pd.slice(1),ri);}}else if(pd[0]===83){e12=1;if(pd.length>0&&pd.length<10)dd('12',true,pd.slice(1),ri);else{result=false;dd('12',false,pd.slice(1),ri);}}else if(pd[0]===69){e13=1;if((pd.length>8&&pd.length<11)||pd.length===1)dd('13',true,pd.slice(1),ri);else{result=false;dd('13',false,pd.slice(1),ri);}}else if(pd[0]===84){if(pd.length>6){e20=1;if(vd(pd.slice(1,7)))dd('20',true,pd.slice(1,7),ri);else{result=false;dd('20',false,pd.slice(1,7),ri);}}if(pd.length>7){e21=1;if(pd.length>10)dd('21',true,pd.slice(7,11),ri);else{result=false;dd('21',false,pd.slice(7),ri);}}if(pd.length>11){e22=1;if(pd[11]===64||pd[11]===65)dd('22',true,pd[11],ri);else{result=false;dd('22',false,pd[11],ri);}}if(pd.length>12){e23=1;dd('23',true,pd.slice(12),ri);}}else if(pd[0]>48&&pd[0]<58){e30=1;if(pd.length>1&&pd.length<42)dd('30',true,pd.slice(2),ri);else{result=false;dd('30',false,pd.slice(2),ri);}}else if(pd[0]===77){e31=1;if(pd.length===1)dd('31',true,pd[1],ri);else if(pd.length===2){if(pd[1]===89||pd[1]===78)dd('31',true,pd[1],ri);else{result=false;dd('31',false,pd[1],ri);}}else{result=false;dd('31',false,pd[1],ri);}}else if(pd[0]===67){e40=1;if(pd.length>0&&pd.length<52)dd('40',true,pd.slice(1),ri);else{result=false;dd('40',false,pd.slice(1),ri);}}});if(!e00){result=false;dd('00',false,fb(rd),ri);}if(!e10){result=false;dd('10',false,null,ri);}if(!e11){result=false;dd('11',false,null,ri);}if(!e12)dd('12',true,null,ri);if(!e20){result=false;dd('20',false,null,ri);}if(!e21){result=false;dd('21',false,null,ri);}if(!e22){result=false;dd('22',false,null,ri);}if(!e23){result=false;dd('23',false,null,ri);}if(!e50){result=false;dd('50',false,lb(rd),ri);}});return result;}}

var LANG={ko:{standard:'H/KMCÎ∂ÄÌíà 2D Î∞îÏΩîÎìú ÌëúÏ§Ä',scan:'Ïä§Ï∫î',history:'Ïù¥Î†•',lang:'Ïñ∏Ïñ¥',barcodeContent:'Î∞îÏΩîÎìú ÎÇ¥Ïö©',item:'Íµ¨Î∂Ñ',result:'Í≤∞Í≥º',data:'Îç∞Ïù¥ÌÑ∞',header:'Header',spec:'ÏÇ¨Ïñë\nÏ†ïÎ≥¥',supplier:'ÏóÖÏ≤¥ÏΩîÎìú',partNo:'Î∂ÄÌíàÎ≤àÌò∏',seqCode:'ÏÑúÏó¥ÏΩîÎìú',eoNo:'EOÎ≤àÌò∏',trace:'Ï∂îÏ†Å\nÏ†ïÎ≥¥',prodDate:'ÏÉùÏÇ∞ÏùºÏûê',part4m:'Î∂ÄÌíà4M',aOrAt:'A or @',traceNo:'Ï∂îÏ†ÅÎ≤àÌò∏\n(7~)',additional:'Î∂ÄÍ∞Ä\nÏ†ïÎ≥¥',special:'ÌäπÏù¥Ï†ïÎ≥¥',initial:'Ï¥àÎèÑÌíàÍµ¨Î∂Ñ',etc:'Í∏∞ÌÉÄ',supplierArea:'ÏóÖÏ≤¥ÏòÅÏó≠',trailer:'Trailer',close:'Îã´Í∏∞',histTitle:'Î∞îÏΩîÎìú Ïù¥Î†•',view:'Î≥¥Í∏∞',noData:'Ïù¥Î†•Ïù¥ ÏóÜÏäµÎãàÎã§',clearAll:'Ï†ÑÏ≤¥ÏÇ≠Ï†ú',selectLang:'Ïñ∏Ïñ¥ ÏÑ†ÌÉù',stopScan:'Ïä§Ï∫î Ï§ëÏßÄ'},en:{standard:'H/KMC Part 2D Barcode Std.',scan:'Scan',history:'History',lang:'Lang',barcodeContent:'Barcode Content',item:'Item',result:'Result',data:'Data',header:'Header',spec:'Spec\nInfo',supplier:'Supplier',partNo:'Part No.',seqCode:'Seq Code',eoNo:'EO No.',trace:'Trace-\nability',prodDate:'Prod Date',part4m:'Part 4M',aOrAt:'A or @',traceNo:'Trace No.\n(7~)',additional:'Addi-\ntional',special:'Special',initial:'Initial',etc:'ETC',supplierArea:'Sup. Area',trailer:'Trailer',close:'Close',histTitle:'History',view:'View',noData:'No history yet',clearAll:'Clear All',selectLang:'Select Language',stopScan:'Stop Scan'}};

var currentLang='ko', analyzer=new DataAnalyzer(), historyList=[], html5QrCode=null;

/* ‚îÄ‚îÄ Page nav ‚îÄ‚îÄ */
function showPage(n){
  document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active');});
  document.getElementById('page-'+n).classList.add('active');
  if(n==='history')renderHistory();
  window.scrollTo(0,0);
}

/* ‚îÄ‚îÄ Lang ‚îÄ‚îÄ */
function setLang(lang){
  currentLang=lang;var L=LANG[lang];
  var m={secBarcode:'barcodeContent',secResult:'result',secStd:'standard',navLang:'lang',navHist:'history',histPageTitle:'histTitle',histClear:'clearAll',histClose:'close',langPageTitle:'selectLang',stopScanBtn:'stopScan'};
  for(var id in m){var el=document.getElementById(id);if(el)el.textContent=L[m[id]];}
  document.getElementById('chkKo').style.display=lang==='ko'?'inline':'none';
  document.getElementById('chkEn').style.display=lang==='en'?'inline':'none';
  showPage('main');
}

/* ‚îÄ‚îÄ Process barcode ‚îÄ‚îÄ */
function processBarcode(data){
  var L=LANG[currentLang];
  analyzer.setBarcodeData(data);
  var ok=analyzer.getCheckResult(), RD=analyzer.getResultData(), tc=analyzer.getCount();
  var okC=RD.filter(function(r){return r[1]==='OK';}).length;
  var ngC=RD.filter(function(r){return r[1]==='NG';}).length;

  // header badge
  var badge=document.getElementById('hdrBadge');
  badge.style.display='block';
  badge.className='hdr-badge '+(ok?'ok':'ng');
  badge.textContent=ok?'‚úì PASS':'‚úó FAIL';

  // hero card update
  document.getElementById('heroLabel').textContent='ÎßàÏßÄÎßâ Ïä§Ï∫î Í≤∞Í≥º';
  document.getElementById('heroValue').textContent=ok?'PASS':'FAIL';
  document.getElementById('heroSub').textContent='Ìï≠Î™© '+RD.length+'Í∞ú ¬∑ OK '+okC+' ¬∑ NG '+ngC;

  // hero button text
  document.getElementById('scanBtnLabel').textContent='Îã§Ïãú Ïä§Ï∫î';

  // barcode raw
  document.getElementById('barcodePanel').style.display='';
  document.getElementById('fullViewData').innerHTML=analyzer.getFullViewData();
  var chip=document.getElementById('rawChip');
  chip.className='panel-chip '+(ok?'ok':'ng');
  chip.textContent=ok?'PASS':'FAIL';

  // tabs
  if(tc>1){
    document.getElementById('tabSection').style.display='';
    var th='';for(var i=0;i<tc;i++){var lb=i===0?'Assy':'Sub'+String(i).padStart(2,'0');th+='<button class="tab-btn'+(i===0?' active':'')+'" onclick="switchTab('+i+')">'+lb+'</button>';}
    document.getElementById('tabBar').innerHTML=th;
  } else document.getElementById('tabSection').style.display='none';

  // result table
  document.getElementById('resultPanel').style.display='';
  renderTable(RD,L);

  // rescan
  document.getElementById('rescanWrap').style.display='';

  // history
  var now=new Date();
  var ds=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0')+' '+String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0');
  historyList.unshift({date:ds,barcode:data,okng:ok?'OK':'NG'});
  if(historyList.length>50)historyList=historyList.slice(0,50);
  var dot=document.getElementById('histDot');
  if(dot){dot.style.display='flex';dot.textContent=historyList.length>9?'9+':historyList.length;}

  var fl=document.getElementById('flashEffect');fl.style.display='';setTimeout(function(){fl.style.display='none';},400);
  showPage('main');
}

function switchTab(idx){
  var L=LANG[currentLang];analyzer.setSelectIndex(idx);
  document.getElementById('fullViewData').innerHTML=analyzer.getFullViewData();
  var ok=analyzer.getCheckResult();
  var chip=document.getElementById('rawChip');chip.className='panel-chip '+(ok?'ok':'ng');chip.textContent=ok?'PASS':'FAIL';
  renderTable(analyzer.getResultData(),L);
  document.querySelectorAll('.tab-btn').forEach(function(b,i){b.className='tab-btn'+(i===idx?' active':'');});
}

function renderTable(RD,L){
  var f={};RD.forEach(function(r){f[r[0]]=true;});
  function gR(c){var rw=null;RD.forEach(function(r){if(r[0]===c)rw=r;});return rw?{r:rw[1],d:rw[2]}:{r:null,d:null};}
  function bH(r){if(!r)return'-';if(r==='OK')return'<span class="badge-ok">OK</span>';if(r==='NG')return'<span class="badge-ng">NG</span>';return r;}
  function dH(d){return d?'<span class="td-data">'+d+'</span>':'';}
  var h='<thead><tr><th colspan="2">'+L.item+'</th><th style="width:54px">'+L.result+'</th><th>'+L.data+'</th></tr></thead><tbody>';
  var rh=gR('00');h+='<tr><td colspan="2" class="td-head">'+L.header+'</td><td class="td-center">'+(rh.r?bH(rh.r):'-')+'</td><td>'+dH(rh.d)+'</td></tr>';
  h+='<tr><td rowspan="4" class="td-head">'+L.spec+'</td><td class="td-head">'+L.supplier+'</td><td class="td-center">'+(gR('10').r?bH(gR('10').r):'-')+'</td><td>'+dH(gR('10').d)+'</td></tr>';
  h+='<tr><td class="td-head">'+L.partNo+'</td><td class="td-center">'+(gR('11').r?bH(gR('11').r):'-')+'</td><td>'+dH(gR('11').d)+'</td></tr>';
  h+='<tr><td class="td-head">'+L.seqCode+'</td><td class="td-center">'+(gR('12').r?bH(gR('12').r):'-')+'</td><td>'+dH(gR('12').d)+'</td></tr>';
  h+='<tr><td class="td-head">'+L.eoNo+'</td><td class="td-center">'+(gR('13').r?bH(gR('13').r):'-')+'</td><td>'+dH(gR('13').d)+'</td></tr>';
  h+='<tr><td rowspan="4" class="td-head">'+L.trace+'</td><td class="td-head">'+L.prodDate+'</td><td class="td-center">'+(gR('20').r?bH(gR('20').r):'-')+'</td><td>'+dH(gR('20').d)+'</td></tr>';
  h+='<tr><td class="td-head">'+L.part4m+'</td><td class="td-center">'+(gR('21').r?bH(gR('21').r):'-')+'</td><td>'+dH(gR('21').d)+'</td></tr>';
  h+='<tr><td class="td-head">'+L.aOrAt+'</td><td class="td-center">'+(gR('22').r?bH(gR('22').r):'-')+'</td><td>'+dH(gR('22').d)+'</td></tr>';
  h+='<tr><td class="td-head">'+L.traceNo+'</td><td class="td-center">'+(gR('23').r?bH(gR('23').r):'-')+'</td><td>'+dH(gR('23').d)+'</td></tr>';
  var r30=gR('30'),r31=gR('31');
  if(f['30']&&f['31']){h+='<tr><td rowspan="2" class="td-head">'+L.additional+'</td><td class="td-head">'+L.special+'</td><td class="td-center">'+(r30.r?bH(r30.r):'-')+'</td><td>'+dH(r30.d)+'</td></tr><tr><td class="td-head">'+L.initial+'</td><td class="td-center">'+(r31.r?bH(r31.r):'-')+'</td><td>'+dH(r31.d)+'</td></tr>';}
  else if(f['30']){h+='<tr><td class="td-head">'+L.additional+'</td><td class="td-head">'+L.special+'</td><td class="td-center">'+(r30.r?bH(r30.r):'-')+'</td><td>'+dH(r30.d)+'</td></tr>';}
  else{h+='<tr><td class="td-head">'+L.additional+'</td><td class="td-head">'+L.initial+'</td><td class="td-center">'+(r31.r?bH(r31.r):'-')+'</td><td>'+dH(r31.d)+'</td></tr>';}
  var r40=gR('40');h+='<tr><td class="td-head">'+L.etc+'</td><td class="td-head">'+L.supplierArea+'</td><td class="td-center">'+(r40.r?bH(r40.r):'-')+'</td><td>'+dH(r40.d)+'</td></tr>';
  var rt=gR('50');h+='<tr><td colspan="2" class="td-head">'+L.trailer+'</td><td class="td-center">'+(rt.r?bH(rt.r):'-')+'</td><td>'+dH(rt.d)+'</td></tr>';
  h+='</tbody>';document.getElementById('resultTable').innerHTML=h;
}

function renderHistory(){
  var el=document.getElementById('historyContent'),L=LANG[currentLang];
  if(historyList.length===0){el.innerHTML='<div class="hist-empty"><div class="hist-empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 8v4l3 3M3.05 11a9 9 0 100 2"/><path d="M3 4v4h4"/></svg></div><div class="hist-empty-title">Ïù¥Î†• ÏóÜÏùå</div><div class="hist-empty-sub">'+L.noData+'</div></div>';return;}
  var h='';historyList.forEach(function(it,i){h+='<div class="hist-item" style="animation-delay:'+(i*.04)+'s"><span class="hist-badge '+(it.okng==='OK'?'ok':'ng')+'">'+it.okng+'</span><div class="hist-meta"><div class="hist-date">'+it.date+'</div><div class="hist-code">'+it.barcode+'</div></div><button onclick="viewHistory('+i+')" class="hist-view">'+L.view+'</button></div>';});
  el.innerHTML=h;
}
function viewHistory(i){processBarcode(historyList[i].barcode);}
function clearHistory(){if(confirm(currentLang==='ko'?'Ï†ÑÏ≤¥ Ïù¥Î†•ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?':'Clear all history?')){historyList=[];var dot=document.getElementById('histDot');if(dot)dot.style.display='none';renderHistory();}}

function startScan(){
  document.getElementById('scanOverlay').classList.add('open');
  if(!html5QrCode)html5QrCode=new Html5Qrcode("qr-reader");
  html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},function(dt){closeScanner();processBarcode(dt);},function(){}).catch(function(){alert(currentLang==='ko'?'Ïπ¥Î©îÎùº Ï†ëÍ∑ºÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.':'Camera access failed.');closeScanner();});
}
function closeScanner(){
  if(html5QrCode&&html5QrCode.isScanning)html5QrCode.stop().then(function(){html5QrCode.clear();});
  document.getElementById('scanOverlay').classList.remove('open');
}

setLang('ko');
</script>
</body>
</html>
